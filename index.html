<!DOCTYPE html>
<html>
<head>
  <title>Giveaway Uang IC</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    input { padding: 10px; margin: 10px; width: 250px; }
    button { padding: 10px 20px; }
    .hidden { display: none; }
    .highlight { background: #e0ffe0; padding: 10px; margin-top: 20px; }
  </style>
</head>
<body>

  <h2>üéÅ Pendaftaran Giveaway Uang IC</h2>

  <div id="formDiv">
    <input type="text" id="nama" placeholder="Nama Lengkap IC"><br>
    <input type="text" id="rekening" placeholder="Nomor Rekening IC"><br>
    <button onclick="daftar()">Daftar Giveaway</button>
    <p id="info" style="color:red;"></p>
  </div>

  
<!-- Notifikasi Hasil Undian -->
<div id="hasilUndian" class="hidden">
  <h2>üéâ Hasil Undian Giveaway</h2>
  <p><strong>Nama:</strong> <span id="pemenangNama"></span></p>
  <p><strong>Rekening:</strong> <span id="pemenangRekening"></span></p>
  <p><strong>Hadiah Uang:</strong> <span id="pemenangHadiah"></span></p>
  <h3 style="color: green;">Selamat! Anda terpilih sebagai pemenang giveaway üéâ</h3>
  <p><i>Hormat kami,</i><br><strong>Reyzen Kyzen</strong></p>
</div>

<div id="terdaftarDiv" class="hidden">
    <h3 class="highlight">‚úÖ Kamu sudah terdaftar!</h3>
    <p><strong>Nama:</strong> <span id="myNama"></span></p>
    <p><strong>No. Rekening:</strong> <span id="myRekening"></span></p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA3-34rf9VZUIrAIR6z4BJtQm_MClqXm-Q",
      authDomain: "uangduty.firebaseapp.com",
      databaseURL: "https://uangduty-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "uangduty",
      storageBucket: "uangduty.firebasestorage.app",
      messagingSenderId: "598905752132",
      appId: "1:598905752132:web:7be400c23de21665044a11"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const userKey = localStorage.getItem("giveawayUserKey");

    if (userKey) {
      db.ref("giveaway/" + userKey).once('value').then(snap => {
        const data = snap.val();
        if (data) tampilkanData(data);
      });
    }

    function daftar() {
      const nama = document.getElementById("nama").value.trim();
      const rekening = document.getElementById("rekening").value.trim();

      if (!nama || !rekening) {
        document.getElementById("info").innerText = "Harap isi semua data!";
        return;
      }

      if (userKey) {
        document.getElementById("info").innerText = "Kamu sudah terdaftar!";
        return;
      }

      const ref = db.ref("giveaway").push();
      const key = ref.key;
      ref.set({
        nama,
        rekening,
        waktu: Date.now()
      }).then(() => {
        localStorage.setItem("giveawayUserKey", key);
        tampilkanData({ nama, rekening });
      });
    }

    function tampilkanData(data) {
      document.getElementById("formDiv").style.display = "none";
      document.getElementById("terdaftarDiv").classList.remove("hidden");
      document.getElementById("myNama").innerText = data.nama;
      document.getElementById("myRekening").innerText = data.rekening;
    }
  </script>

<!-- Tampilkan countdown untuk peserta -->
<p id="waktuCountdown" style="font-size:18px; font-weight:bold;"></p>

<script>
db.ref("waktu_akhir").on("value", (snap) => {
  const akhir = snap.val();
  if (!akhir) return;
  const countdown = document.getElementById("waktuCountdown");
  setInterval(() => {
    const sisa = akhir - Date.now();
    if (sisa <= 0) {
      countdown.innerText = "‚õî Pendaftaran sudah ditutup!";
      document.getElementById("formDiv").style.display = "none";
    } else {
      const jam = Math.floor(sisa / (1000 * 60 * 60));
      const menit = Math.floor((sisa % (1000 * 60 * 60)) / (1000 * 60));
      const detik = Math.floor((sisa % (1000 * 60)) / 1000);
      countdown.innerText = `üïí Sisa Waktu Pendaftaran: ${jam}j ${menit}m ${detik}d`;
    }
  }, 1000);
});
</script>

<script>
// Cek apakah peserta menang
db.ref("pemenang").on("value", (snap) => {
  const data = snap.val();
  if (!data) return;

  const key = localStorage.getItem("giveawayUserKey");
  if (!key) return;

  const hasil = data[key];
  if (hasil) {
    document.getElementById("formDiv").style.display = "none";
    document.getElementById("terdaftarDiv").style.display = "none";
    const hasilDiv = document.getElementById("hasilUndian");
    hasilDiv.classList.remove("hidden");
    document.getElementById("pemenangNama").innerText = hasil.nama;
    document.getElementById("pemenangRekening").innerText = hasil.rekening;
    document.getElementById("pemenangHadiah").innerText = "Rp " + hasil.hadiah.toLocaleString();
  }
});
</script>
</body>
</html>
